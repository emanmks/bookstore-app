<!-- Main Row =============================================== --><div class="container-fluid">    <div class="row-fluid">        <div class="well">            <h2 class="text-info"><a href="<? echo URL; ?>loan">Piutang</a>&nbsp;&nbsp;<small>Riwayat Pembayaran</small></h2>        </div>        <div class="well">            <div class="pull-right">                <button class="btn btn-primary" onClick="showFormPayment()">Pembayaran</button>            </div>	            <br><br>            <table class="table" style="border:none">                <tr>                    <td>Nomor Piutang : <? echo $this->loanDetails['code']; ?></td>                    <td>Nomor Penjualan :                         <a href="javascript:void(0)" onClick="loadWholesaleDetails(<? echo $this->loanDetails['selling']; ?>)">                            <? echo $this->loanDetails['sellcode']; ?>                        </a>                    </td>                    <td>Pelanggan : <? echo $this->loanDetails['costumername']; ?></td>                    <td>Deadline Pelunasan :                         <? if(($this->loanDetails['settled'] == 0) && (date('Y-m-d') >= date('Y-m-d', strtotime($this->loanDetails['deadline'])))) : ?>                             <span class='text-error'><? echo date('d-m-Y', strtotime($this->loanDetails['deadline'])); ?></span>                        <? else: ?>                            <span class="text-info"><? echo date('d-m-Y', strtotime($this->loanDetails['deadline'])); ?></span>                        <? endif; ?>                    </td>                </tr>            </table>            <table class="table table-bordered table-hover">                <thead>                    <tr>                        <th width='15%'>Kode Pembayaran</th>                        <th>Tanggal Pembayaran</th>                        <th width="40%">Keterangan</th>                        <th>Pembayaran</th>                        <th width="10%">Aksi</th>                    </tr>                </thead>                <tbody id="tblPayment">                <? foreach ($this->listPayment as $key => $value) { ?>                    <tr id="payment-<? echo $value['id']; ?>">                        <td><? echo $value['code']; ?></td>                        <td><? echo date('d-m-Y', strtotime($value['paydate'])); ?></td>                        <td><? echo $value['info']; ?></td>                        <td><div clas="pull-right"><? echo $this->pecah($value['payment']); ?></div></td>                        <td>                            <div class="btn-group">                                <a class="btn btn-info" href="javascript:void(0)"><i class="icon-edit icon-white"></i> Aksi</a>                                <a class="btn btn-info dropdown-toggle" data-toggle="dropdown" href="javascript:void(0)"><span class="caret"></span></a>                                <ul class="dropdown-menu">                                    <li>                                        <a href="javascript:void(0)" onClick="loadPrintPayment(<? echo $value['id']; ?>)">                                        <i class="icon-print"></i> Cetak Bukti Pembayaran</a>                                    </li>                                    <li>                                        <a href="javascript:void(0)" onClick="deletePayment(<? echo $this->loanDetails['id']; ?>,<? echo $value['id']; ?>)">                                        <i class="icon-remove"></i> Anulir Pembayaran</a>                                    </li>                                </ul>                            </div>                        </td>                    </tr>                <? } ?>                </tbody>            </table>            <table class="table" style="border:none">                <tr>                    <td>Total Piutang : <? echo $this->pecah($this->loanDetails['total']); ?></td>                    <td>Total DP : <? echo $this->pecah($this->loanDetails['dp']); ?></td>                    <td>Terbayar : <? echo $this->pecah($this->loanDetails['total']-$this->loanDetails['balance']); ?></td>                    <td>Sisa Piutang : <? echo $this->pecah($this->loanDetails['balance']); ?></td>                </tr>            </table>            <input type="hidden" id="employee" value="<? echo Session::get('user_id'); ?>">        </div>    </div></div><!-- Form Payment [modal]===================================== --><div id="formPayment" class="modal hide fade" tabindex="-1" aria-hidden="true">    <div class="modal-header">        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>        <h3 id="myModalLabel">Bayar Piutang</h3>    </div>    <div class="modal-body">        <form class="form-horizontal">            <div class="control-group">                <label class="control-label" for="inputName">Judul / Nama</label>                <div class="controls">                    <input id="inputLoanID" type="hidden" value="0">                    <input id="inputParam" class="span3" type="text" data-provide="typeahead" placeholder="Nomor Tagihan/Pelanggan">                </div>            </div>	            <div class="control-group">                <label class="control-label" for="inputBalance">Sisa</label>                <div class="controls">                    <input id="inputBalance" type="text" class="span2" disabled>                </div>            </div>            <div class="control-group">                <label class="control-label" for="inputPayDate">Tanggal Bayar</label>                <div class="controls">                    <input id="inputPayDate" class="span2" type="text" data-provide="datepicker" value="<? echo date('Y-m-d'); ?>">                </div>            </div>            <div class="control-group">                <label class="control-label" for="inputTotal">Pembayaran</label>                <div class="controls">                    <input id="inputTotal" type="text" class="span2" onkeyup="formatNumber(this)">                </div>            </div>            <div class="control-group">                <label class="control-label" for="inputStatus">Status</label>                <div class="controls">                    <select id="inputStatus">                        <option value="0">Belum Lunas</option>                        <option value="1">Lunas</option>                    </select>                </div>            </div>            <div class="control-group">                <label class="control-label" for="inputInfo">Informasi</label>                <div class="controls">                    <textarea id="inputInfo"></textarea>                </div>            </div>        </form>    </div>    <div class="modal-footer">        <button class="btn" data-dismiss="modal" aria-hidden="true">Batal</button>        <button class="btn btn-primary" onClick="addPayment()" data-dismiss="modal" aria-hidden="true">Simpan</button>    </div></div><!-- End of Form Payment [modal] --><script type="text/javascript">    $(function(){        $('#inputPayDate').datepicker({format: 'yyyy-mm-dd', autoclose : true});        $('#inputParam').typeahead({            source : function(query,process){                return $.post(site+'loan/xlistloan', {param : query}, function(response){                    response = $.parseJSON(response);                    var sourceArr = [];	                    for(var i = 0; i < response.length; i++)                    {                        sourceArr.push(response[i].id +"#"+ response[i].code +"#"+ response[i].costumername +"#"+ response[i].balance);                    }                    return process(sourceArr);                })            },            highlighter : function(item){                var loan = item.split('#');                var item = ''                + "<div class='typeahead_wrapper'>"                + "<img class='typeahead_photo' src='"+site+"assets/img/user.png'/>"                + "<div class='typeahead_labels'>"                + "<div class='typeahead_primary'>" + loan[2] + "</div>"                + "<div class='typeahead_secondary'>Nomor : #" + loan[1] + " | Sisa : " + formatRupiah(loan[3]) + "</div>"                + "</div>"                + "</div>";            return item;            },            updater : function(item){                var loan = item.split('#');                $('#inputLoanID').val(loan[0]);                $('#inputBalance').val(loan[3]);                return loan[1];            }        });    })    function showFormPayment()    {        $('#formPayment').modal('show');    }        function loadWholesaleDetails(id)    {        window.location = site+"wholesale/details/"+id;    }        function loadPrintPayment(id)    {        window.location = site+"loan/printpayment/"+id;    }        function addPayment()    {        var loan = $('#inputLoanID').val();        var employee = $('#employee').val();        var paydate = $('#inputPayDate').val();        var payment = parseInt(replaceAll($('#inputTotal').val(),',',''));        var status = $('#inputStatus').val();        var info = $('#inputInfo').val();        $.post(site+'loan/addpayment',            {loan : loan,            employee : employee,            paydate : paydate,            payment : payment,            status : status,            info : info},            function(data){                    window.location = site+"loan/printpayment/"+data.id;            },'json');    }    function deletePayment(loan,id)    {        if(confirm('Anda Yakin Akan Membatalkan Pembayaran Piutang ini?'))        {            $.post(site+'loan/deletepayment',{id : id}, function(){                load('loan/historypayment/'+loan,'#content');            });        }    }</script>