<!-- Main Row =============================================== --><div class="container-fluid">    <div class="row-fluid">        <div class="well">            <h2 class="text-info"><a href="<? echo URL; ?>loan">Piutang</a>&nbsp;&nbsp;<small>Riwayat Hutang Pelanggan</small></h2>        </div>        <div class="well">            <div class="pull-right">                <button class="btn btn-primary" onClick="showFormPayment()">Pembayaran</button>            </div>	            <br><br>            <legend><small>Riwayat Hutang :</small> <? echo $this->costumerDetails['name']; ?></legend>            <p>                Kode : <? echo $this->costumerDetails['code']; ?></br>                Alamat : <? echo $this->costumerDetails['address']; ?></br>                Telepon : <? echo $this->costumerDetails['phone']; ?></br>            </p>            <table class="table table-bordered table-hover">                <thead>                    <tr>                        <th width='15%'>Nomor Tagihan</th>                        <th>Total Hutang</th>                        <th>Down Payment</th>                        <th>Sisa Piutang</th>                        <th>Deadline</th>                        <th>Status</th>                    </tr>                </thead>                <tbody id="tblLoan">                <? $sumTotal = 0; $sumDP = 0; $sumBalance = 0;                    foreach ($this->listLoan as $key => $value) {                         $sumTotal += $value['total']; $sumDP += $value['dp']; $sumBalance += $value['balance']; ?>                    <tr id="loan-<? echo $value['id']; ?>">                        <td><a href="#" onClick="loadHistoryPayment(<? echo $value['id']; ?>)"><? echo $value['code']; ?></a></td>                        <td><? echo $this->pecah($value['total']); ?></td>                        <td><? echo $this->pecah($value['dp']); ?></td>                        <td><? echo $this->pecah($value['balance']); ?></td>                        <td>                            <? if(($value['settled'] == 0) && (date('Y-m-d') >= date('Y-m-d', strtotime($value['deadline'])))) : ?>                                 <span class='text-error'><? echo date('d-m-Y', strtotime($value['deadline'])); ?></span>                            <? else: ?>                                <span class="text-info"><? echo date('d-m-Y', strtotime($value['deadline'])); ?></span>                            <? endif; ?>                        </td>                        <td><? echo $value['settled'] == 0 ? "Belum Lunas" : "Lunas"; ?></td>                    </tr>                <? } ?>                    <tr>                        <td>Akumulasi</td>                        <td><strong><? echo $this->pecah($sumTotal) ?></strong></td>                        <td><strong><? echo $this->pecah($sumDP) ?></strong></td>                        <td><strong><? echo $this->pecah($sumBalance) ?></strong></td>                        <td colspan="3"></td>                    </tr>                </tbody>            </table>            <div class="pull-right">                <button class="btn btn-inverse" onClick="showCostumerBook(<? echo $this->costumerDetails['id']; ?>)"><i class="icon-print icon-white"></i> Cetak Kontrol Hutang Pelanggan</button>            </div>             <br/>             <input type="hidden" id="employee" value="<? echo Session::get('user_id'); ?>">        </div>    </div></div><!-- Form Payment [modal]===================================== --><div id="formPayment" class="modal hide fade" tabindex="-1" aria-hidden="true">    <div class="modal-header">        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>        <h3 id="myModalLabel">Bayar Piutang</h3>    </div>    <div class="modal-body">        <form class="form-horizontal">            <div class="control-group">                <label class="control-label" for="inputName">Judul / Nama</label>                <div class="controls">                    <input id="inputLoanID" type="hidden" value="0">                    <input id="inputParam" class="span3" type="text" data-provide="typeahead" placeholder="Nomor Tagihan/Pelanggan">                </div>            </div>	            <div class="control-group">                <label class="control-label" for="inputBalance">Sisa</label>                <div class="controls">                    <input id="inputBalance" type="text" class="span2" disabled>                </div>            </div>            <div class="control-group">                <label class="control-label" for="inputPayDate">Tanggal Bayar</label>                <div class="controls">                    <input id="inputPayDate" class="span2" type="text" data-provide="datepicker" value="<? echo date('Y-m-d'); ?>">                </div>            </div>            <div class="control-group">                <label class="control-label" for="inputTotal">Pembayaran</label>                <div class="controls">                    <input id="inputTotal" type="text" class="span2" onkeyup="formatNumber(this)">                </div>            </div>            <div class="control-group">                <label class="control-label" for="inputStatus">Status</label>                <div class="controls">                    <select id="inputStatus">                        <option value="0">Belum Lunas</option>                        <option value="1">Lunas</option>                    </select>                </div>            </div>            <div class="control-group">                <label class="control-label" for="inputInfo">Informasi</label>                <div class="controls">                    <textarea id="inputInfo"></textarea>                </div>            </div>        </form>    </div>    <div class="modal-footer">        <button class="btn" data-dismiss="modal" aria-hidden="true">Batal</button>        <button class="btn btn-primary" onClick="addPayment()" data-dismiss="modal" aria-hidden="true">Simpan</button>    </div></div><!-- End of Form Payment [modal] --><script type="text/javascript">    $(function(){        $('#inputPayDate').datepicker({format: 'yyyy-mm-dd', autoclose : true});        $('#inputParam').typeahead({            source : function(query,process){                return $.post(site+'loan/xlistloan', {param : query}, function(response){                    response = $.parseJSON(response);                    var sourceArr = [];	                    for(var i = 0; i < response.length; i++)                    {                        sourceArr.push(response[i].id +"#"+ response[i].code +"#"+ response[i].costumername +"#"+ response[i].balance);                    }                    return process(sourceArr);                })            },            highlighter : function(item){                var loan = item.split('#');                var item = ''                + "<div class='typeahead_wrapper'>"                + "<img class='typeahead_photo' src='"+site+"assets/img/user.png'/>"                + "<div class='typeahead_labels'>"                + "<div class='typeahead_primary'>" + loan[2] + "</div>"                + "<div class='typeahead_secondary'>Nomor : #" + loan[1] + " | Sisa : " + formatRupiah(loan[3]) + "</div>"                + "</div>"                + "</div>";            return item;            },            updater : function(item){                var loan = item.split('#');                $('#inputLoanID').val(loan[0]);                $('#inputBalance').val(loan[3]);                return loan[1];            }        });    })    function showFormPayment()    {        $('#formPayment').modal('show');    }    function showCostumerBook(costumer)    {        window.location = site+"loan/costumerbook/"+costumer;    }    function loadHistoryPayment(id)    {        window.location = site+"loan/historypayment/"+id;    }    function addPayment()    {        var loan = $('#inputLoanID').val();        var employee = $('#employee').val();        var paydate = $('#inputPayDate').val();        var payment = parseInt(replaceAll($('#inputTotal').val(),',',''));        var status = $('#inputStatus').val();        var info = $('#inputInfo').val();        $.post(site+'loan/addpayment',            {loan : loan,            employee : employee,            paydate : paydate,            payment : payment,            status : status,            info : info},            function(data){                load('loan/printpayment/'+data.id, '#content');            },'json');    }</script>