<!-- Main Row =============================================== --><div class="container-fluid">    <div class="row-fluid">        <div class="well">                <h2 class="text-info"><a href="<? echo URL; ?>loan">Piutang</a></h2>        </div>        <div class="well">            <div class="pull-right">                <button class="btn btn-primary" onClick="showFormPayment()"><i class="icon-ok icon-white"></i> Pembayaran</button>            </div>	            <br><br>            <input id="inputSearching" class="span5" type="text" data-provide="typeahead" placeholder="Ketikkan Kode Piutang atau Nama Pelanggan">            <table class="table table-bordered table-hover">                <thead>                    <tr>                        <th width='15%'>Kode Piutang</th>                        <th>Pelanggan</th>                        <th>Total Piutang</th>                        <th>Down Payment</th>                        <th>Sisa Piutang</th>                        <th>Deadline</th>                        <th>Status</th>                        <th>Aksi</th>                    </tr>                </thead>                <tbody id="tblLoan">                <? foreach ($this->listLoan as $key => $value) { ?>                    <tr id="loan-<? echo $value['id']; ?>">                        <td><a href="javascript:void(0)" onClick="loadHistoryPayment(<? echo $value['id']; ?>)"><? echo $value['code']; ?></a></td>                        <td><a href="javascript:void(0)" onClick="loadHistoryCostumer(<? echo $value['costumer']; ?>)"><? echo $value['costumername']; ?></a></td>                        <td><div class="pull-right"><? echo $this->pecah($value['total']); ?></div></td>                        <td><div class="pull-right"><? echo $this->pecah($value['dp']); ?></div></td>                        <td><div class="pull-right"><? echo $this->pecah($value['balance']); ?></div></td>                        <td>                            <? if(($value['settled'] == 0) && (date('Y-m-d') >= date('Y-m-d', strtotime($value['deadline'])))) : ?>                                 <span class='text-error'><? echo date('d-m-Y', strtotime($value['deadline'])); ?></span>                            <? else: ?>                                <span class="text-info"><? echo date('d-m-Y', strtotime($value['deadline'])); ?></span>                            <? endif; ?>                        </td>                        <td><? echo $value['settled'] == 0 ? "Belum Lunas" : "Lunas"; ?></td>                        <td><button class="btn btn-danger" onClick="closeLoan(<? echo $value['id'] ?>)"><i class="icon-remove icon-white"></i> Tutup/Lunasi</button></td>                    </tr>                <? } ?>                </tbody>            </table>            <input type="hidden" id="employee" value="<? echo Session::get('user_id'); ?>">        </div>    </div></div><!-- Form Payment [modal]===================================== --><div id="formPayment" class="modal hide fade" tabindex="-1" aria-hidden="true">	<div class="modal-header">		<button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>		<h3 id="myModalLabel">Bayar Piutang</h3>	</div>	<div class="modal-body">		<form class="form-horizontal">			<div class="control-group">				<label class="control-label" for="inputName">Judul / Nama</label>				<div class="controls">					<input id="inputLoanID" type="hidden" value="0">					<input id="inputParam" class="span3" type="text" data-provide="typeahead" placeholder="Nomor Tagihan/Pelanggan">				</div>			</div>				<div class="control-group">				<label class="control-label" for="inputBalance">Sisa</label>				<div class="controls">					<input id="inputBalance" type="text" class="span2" disabled>				</div>			</div>			<div class="control-group">				<label class="control-label" for="inputPayDate">Tanggal Bayar</label>				<div class="controls">					<input id="inputPayDate" class="span2" type="text" data-provide="datepicker" value="<? echo date('Y-m-d'); ?>">				</div>			</div>						<div class="control-group">				<label class="control-label" for="inputTotal">Pembayaran</label>				<div class="controls">					<input id="inputTotal" type="text" class="span2" onkeyup="formatNumber(this)">				</div>			</div>			<div class="control-group">				<label class="control-label" for="inputStatus">Status</label>				<div class="controls">					<select id="inputStatus">						<option value="0">Belum Lunas</option>						<option value="1">Lunas</option>					</select>				</div>			</div>			<div class="control-group">				<label class="control-label" for="inputInfo">Informasi</label>				<div class="controls">					<textarea id="inputInfo"></textarea>				</div>			</div>		</form>	</div>	<div class="modal-footer">		<button class="btn" data-dismiss="modal" aria-hidden="true">Batal</button>		<button class="btn btn-primary" onClick="addPayment()" data-dismiss="modal" aria-hidden="true">Simpan</button>	</div></div><!-- End of Form Payment [modal] --><script type="text/javascript">    $(function(){        $('#inputPayDate').datepicker({format: 'yyyy-mm-dd', autoclose : true});        $('#inputParam').typeahead({            source : function(query,process){                return $.post(site+'loan/xlistloan', {param : query}, function(response){                    response = $.parseJSON(response);                    var sourceArr = [];	                    for(var i = 0; i < response.length; i++)                    {                        sourceArr.push(response[i].id +"#"+ response[i].code +"#"+ response[i].costumername +"#"+ response[i].balance);                    }                    return process(sourceArr);                })            },            highlighter : function(item){                var loan = item.split('#');                var item = ''                + "<div class='typeahead_wrapper'>"                + "<img class='typeahead_photo' src='"+site+"assets/img/user.png'/>"                + "<div class='typeahead_labels'>"                + "<div class='typeahead_primary'>" + loan[2] + "</div>"                + "<div class='typeahead_secondary'>Nomor : #" + loan[1] + " | Sisa : " + formatRupiah(loan[3]) + "</div>"                + "</div>"                + "</div>";            return item;            },            updater : function(item){                var loan = item.split('#');                $('#inputLoanID').val(loan[0]);                $('#inputBalance').val(loan[3]);                return loan[1];            }        });        $('#inputSearching').typeahead({            source : function(query,process){                return $.post(site+'loan/xlistloan', {param : query}, function(response){                    response = $.parseJSON(response);                    var sourceArr = [];	                    for(var i = 0; i < response.length; i++)                    {                        sourceArr.push(response[i].id +"#"+ response[i].code +"#"+ response[i].costumername +"#"+ response[i].balance);                    }                    return process(sourceArr);                })            },            highlighter : function(item){                var loan = item.split('#');                var item = ''                + "<div class='typeahead_wrapper'>"                + "<img class='typeahead_photo' src='"+site+"assets/img/user.png'/>"                + "<div class='typeahead_labels'>"                + "<div class='typeahead_primary'>" + loan[2] + "</div>"                + "<div class='typeahead_secondary'>Nomor : #" + loan[1] + " | Sisa : " + formatRupiah(loan[3]) + "</div>"                + "</div>"                + "</div>";            return item;            },            updater : function(item){                var loan = item.split('#');                load('loan/historypayment/'+loan[0],'#content');            }        });    })    function showFormPayment()    {        $('#formPayment').modal('show');    }    function loadHistoryPayment(id)    {        window.location = site+"loan/historypayment/"+id;    }    function loadHistoryCostumer(costumer)    {        window.location = site+"loan/historycostumer/"+costumer;    }    function addPayment()    {        var loan = $('#inputLoanID').val();        var employee = $('#employee').val();        var paydate = $('#inputPayDate').val();        var payment = parseInt(replaceAll($('#inputTotal').val(),',',''));        var status = $('#inputStatus').val();        var info = $('#inputInfo').val();        $.post(site+'loan/addpayment',            {loan : loan,            employee : employee,            paydate : paydate,            payment : payment,            status : status,            info : info},            function(data){                load('loan/printpayment/'+data.id, '#content');            },'json');    }    function closeLoan(id)    {        if(confirm('Anda Yakin Akan Menutup/Melunasi Piutang ini?'))        {            $.post(site+'loan/closeloan',{id : id}, function(){                window.location = site+"loan";            });        }    }</script>